- [IAM: Users & Groups](#IAM:-Users-&-Groups)
  - [IAM User 만들기](##IAM-User-만들기)
  - [정책](##-정책)
  - [Password Policy](##Password-Policy)
    - [가상 MFA 장치](###가상-MFA-장치)
    - [U2F 보안 키](###U2F-보안-키)

# IAM: Users & Groups

IAM 은 `Identity and Access Management` 의 약자로  
IAM 에서는 사용자를 생성하고  
그룹에 배치하기 때문에 글로벌 서비스에 해당됩니다  

AWS에서는 모든 사용자에게 모든 것을 허용하지 않습니다  
그러면 엉망이 될 겁니다  
새로운 사용자가 너무 많은 서비스를 실행하여 큰 비용이  
발생하거나, 보안 문제를 야기할 수 있기 때문이죠  
따라서 AWS에서는 최소 권한의 원칙을 적용합니다  
즉 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않는 것입니다.  

## IAM User 만들기

처음으로 할 일은 IAM 사용자를 생성하는 것이죠

https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/users

Users 항목으로 이동해 Add users 를 선택하겠습니다  
보시는 것처럼 상단의 계정 이름을 클릭해 보시면  
현재 루트 계정을 사용 중이죠  
루트 사용자는 계정에 대한 모든 권한을 가지고 있습니다  
그렇기 때문에 위험한 계정이 될 수도 있죠  
따라서 별도의 관리자 계정을 만드는 것이 좋습니다  
루트 계정은 정말로 반드시 꼭 필요할 때만 사용할 겁니다  

그룹 이름은 admin으로 하겠습니다  
admin 그룹에 배치된 사용자는  
이 그룹에 부여된 권한을 승계하게 됩니다  
그리고 권한은 정책을 통해 정의되죠  
admin 그룹에 연결할 정책은 AdministratorAccess 입니다
이 정책은 admin 그룹에 속한 모든 사용자가
계정의 관리자 역할을 하도록 허용할 겁니다  

Next: Tags를 클릭합니다  
AWS에서는 어디에서든 태그를 찾을 수 있는데요  
사용자의 접근을 추적, 조직, 제어할 수 있도록 도와주는 정보입니다    
이 강의에서는 굳이 여기저기에 태그를 만들지 않을 겁니다  
다만 사용자를 위한 태그 생성 방법을 보여드리죠  
그 특정 사용자에 대해 단순히 정보를 추가하는 것입니다  
예를 들어, 이 사용자가 속한 부서는 엔지니어링이라고 표시할 수 있죠

## 정책

~~~
{
    "Version": "2012-10-17",
    "Id": "S3-Account-Permissions"
    "Statement": [
        {
            "Sid": "1",
            "Effect": "Allow",
            "Principal": {
                "AWS": ["arn:aws:iam::123123123:root"]
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
            ],
            "Resource": ["arn:aws:s3:::mybuckey/*"]
        }
    ]
}
~~~

IAM 정책 구조 요소는 버전 숫자를 포함하는데요  
보통은 2012-10-17로 정책 언어 버전입니다  
정책을 식별하는 `ID` 도 있는데 선택 사항이고요  
문장들도 구성 요소입니다  
문장은 하나일 수도 여러 개일 수도 있는데  
문장에는 아주 중요한 부분들이 있죠  
먼저 `Sid` 는 문장 ID로 문장의 식별자이고 역시 선택 사항입니다  
오른쪽에 보시면 1번이라고 나와있죠  
정책에서 `Effect` 는 문장이 특정 API에 접근하는 걸 허용할지 거부할지에 대한 내용입니다  
`Principal` 은 특정 정책이 적용될 사용자, 계정, 혹은 역할로 구성됩니다
이 예시에선 AWS 계정의 루트 계정에 적용이 되죠  
`Action` 은 `Effect` 에 기반해 허용 및 거부되는 API 호출의 목록입니다  
그리고 `Resource` 는 적용될 `Action` 의 리소스의 목록으로  
이 예시에선 버킷이지만 다른 것들도 될 수도 있겠죠

## Password Policy

이 그룹과 사용자들의 정보가 침해당하지 않도록 보호해야겠죠  
다요소 인증, `MFA` 입니다  
`MFA` 는 여러분이 알고 있는 비밀번호와  
여러분이 가지고 있는 보안 장치를 함께 사용하는 것입니다  
`MFA` 의 장점은 사용자가 해킹을 당해 비밀번호가  
누출된 상황이라고 해도 해커에게는 로그인을 위해 휴대전화 등  
사용자 소유의 물리적 장치가 추가로 필요해질 테니  
계정이 침해당하지 않는다는 점입니다  

AWS 에서의 `MFA 장치 옵션` 으로는 어떤 것들이 있을까요?

### 가상 MFA 장치

`Google Authenticator` 를 사용할 수 있는데 하나의 휴대전화에서만 사용이 가능하죠
`Authy` 는 여러 장치에서 사용이 가능합니다  
장치의 개수가 다를 뿐 작동 방식은 동일합니다  
개인적으로 저는 `Authy` 를 사용하는데 컴퓨터와  
휴대전화에서 같이 사용할 수 있기 때문이죠  
`Authy` 는 하나의 장치에서도 토큰을 여러 개 지원합니다  
즉, 가상 `MFA` 장치를 사용하면  
루트 계정, IAM 사용자 또 다른 계정, 그리고  
또 다른 IAM 사용자가 지원되는 식으로 가상 MFA 장치에  
원하는 수만큼의 계정 및 사용자 등록이 가능합니다  

### U2F 보안 키

이는 물리적 장치로 예를 들어  
Yubico 사의 YubiKey 가 있죠 Yubico 는 AWS 의 제3자 회사로  
AWS 제공 장치가 아니라 제3자 회사의 장치입니다  
이렇게 `물리적 장치를 사용하면 전자 열쇠`에 달고 다닐 수 있으니  
사용이 상당히 편리할 수 있겠죠  
YubiKey 는 하나의 보안 키에서 여러 루트 계정과 IAM 사용자를  
지원하기 때문에 하나의 키로도 충분합니다

### 하드웨어 키 팝 MFA 장치

역시 AWS 의 제3자 회사인 Gemalto 의 제품입니다  
만약 미국 정부의 클라우드인 AWS GovCloud 를  
사용하시는 경우라면, MFA 숫자를 실시간으로 보여주는 특수한 키 팝(작은 물건)이 필요한데요  
역시 SurePassID 라는 제3자 회사가 제공하고 있죠  

## MFA 설정

왼쪽의 `Account settings (계정 설정)` 에 들어가서  
`Change password policy (암호 정책 변경)` 를 누르면  
여기서 비밀번호 정책 적용이 가능하죠    
비밀번호 최소 길이 지정이 가능하고  
적어도 하나의 대문자 및 소문자 숫자를 포함하도록 합니다  

오른쪽에 있는 계정 이름을 클릭하고  
`My Security Credential(보안 자격 증명)` 로 들어갑니다  
https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/security_credentials

`Multi-factor authentication (MFA) - 멀티 팩터 인증` 를 클릭하고  
휴대전화를 사용할 거니까 Virtual MFA device 를 선택하겠습니다

